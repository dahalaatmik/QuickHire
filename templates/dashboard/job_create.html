{% extends 'dashboard/base_dashboard.html' %}

{% block title %}Create Job{% endblock %}
{% block breadcrumb %}Job Postings / Create{% endblock %}

{% block page_content %}
<div style="max-width:720px;">
    <h1 style="font-size:var(--font-size-2xl);font-weight:700;color:var(--color-text-high);margin-bottom:var(--spacing-xs);">Create New Job Posting</h1>
    <p style="font-size:var(--font-size-sm);color:var(--color-text-disabled);margin-bottom:var(--spacing-xl);">Paste a job description and our AI will extract requirements, skills, and criteria automatically.</p>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div style="margin-bottom:var(--spacing-lg);">
        {% for msg in messages %}
        <div class="flash-message" style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);color:#EF4444;padding:var(--spacing-sm) var(--spacing-md);border-radius:8px;font-size:var(--font-size-sm);margin-bottom:var(--spacing-xs);">{{ msg }}</div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('jobs.job_create') }}" id="job-create-form">
        <div class="form-group" style="margin-bottom:var(--spacing-lg);">
            <label for="title" style="display:block;font-weight:600;color:var(--color-text-high);margin-bottom:var(--spacing-xs);">Job Title</label>
            <input type="text" id="title" name="title" placeholder="e.g. Senior Backend Developer" value="{{ title or '' }}" required
                   style="width:100%;padding:var(--spacing-sm) var(--spacing-md);background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;color:var(--color-text-high);font-size:var(--font-size-base);">
        </div>

        <div class="form-group" style="margin-bottom:var(--spacing-lg);">
            <label for="description" style="display:block;font-weight:600;color:var(--color-text-high);margin-bottom:var(--spacing-xs);">Job Description</label>
            <p style="font-size:var(--font-size-xs);color:var(--color-text-disabled);margin-bottom:var(--spacing-sm);">Paste the full job description. Our AI will extract skills, experience requirements, education criteria, and more.</p>
            <textarea id="description" name="description" rows="16" placeholder="Paste your full job description here..."
                      style="width:100%;padding:var(--spacing-md);background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;color:var(--color-text-high);font-size:var(--font-size-sm);line-height:1.6;resize:vertical;min-height:300px;" required>{{ description or '' }}</textarea>
            <div style="display:flex;justify-content:space-between;margin-top:var(--spacing-xs);">
                <span style="font-size:var(--font-size-xs);color:var(--color-text-disabled);">Minimum 50 characters</span>
                <span id="char-count" style="font-size:var(--font-size-xs);color:var(--color-text-disabled);">0 characters</span>
            </div>
        </div>

        <div style="display:flex;gap:var(--spacing-md);align-items:center;">
            <button type="submit" class="btn-primary" id="submit-btn">
                <i data-feather="zap"></i> Create & Analyze with AI
            </button>
            <a href="{{ url_for('jobs.jobs_list') }}" class="btn-outline">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    if (window.feather) feather.replace();

    const textarea = document.getElementById('description');
    const charCount = document.getElementById('char-count');
    const form = document.getElementById('job-create-form');
    const submitBtn = document.getElementById('submit-btn');

    textarea.addEventListener('input', () => {
        charCount.textContent = textarea.value.length + ' characters';
    });
    // Init count
    charCount.textContent = textarea.value.length + ' characters';

    form.addEventListener('submit', () => {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="loader" style="width:16px;height:16px;border-width:2px;"></span> Analyzing with AI...';
    });
});
</script>
{% endblock %}
